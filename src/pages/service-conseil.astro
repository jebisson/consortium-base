---
import SiteLayout from "../layouts/SiteLayout.astro";
import "../styles/global.css";
import logo from "../assets/consortium.png";
import { theme } from "../config/theme.js";

const { background, text, accent, border, bandBackground, glowColor } = theme.colors;

const inclus = [
  {
    title: "Vérification de soumissions",
    desc: "Analyse comparative (prix, portée, exclusions, garanties) et recommandations pour choisir la meilleure option."
  },
  {
    title: "Consultation stratégique",
    desc: "Orientation TI, gouvernance, priorités cybersécurité, planification et optimisation des coûts."
  },
  {
    title: "Avis technique neutre",
    desc: "Validation d’architecture, choix de solutions (M365, sauvegarde, sécurité, réseaux), impacts et risques."
  },
  {
    title: "Revue de posture & bonnes pratiques",
    desc: "Recommandations de base (MFA, accès admin, partage externe, politiques) et “quick wins”."
  },
  {
    title: "Aide à la rédaction",
    desc: "Cahier des charges, listes d’exigences, critères d’évaluation, questions aux fournisseurs."
  },
  {
    title: "Accompagnement décisionnel",
    desc: "Réunions avec direction / gestionnaires pour clarifier besoins, options et trajectoire."
  }
];

const nonInclus = [
  "Interventions techniques (installation, configuration, support utilisateurs, dépannage)",
  "Gestion quotidienne TI (services gérés, RMM/EDR, opérations 24/7)",
  "Travaux sur site / déplacements",
  "Implantations de projet (migrations, déploiements, mise en production)",
  "Accès administratif à vos systèmes (sauf cas d’audit convenu séparément)",
];

const steps = [
  { n: "1", t: "Cadrage", d: "On clarifie le contexte, les objectifs, et les contraintes (budget, délais, conformité)." },
  { n: "2", t: "Analyse", d: "On compare les options, on identifie les risques, et on valide les impacts techniques." },
  { n: "3", t: "Recommandation", d: "Vous recevez une recommandation claire + prochaines étapes (priorités, quick wins)." },
];
---

<SiteLayout title="Service conseil TI – Le Consortium">
  <div style={`--bg:${background}; --text:${text}; --accent:${accent}; --border:${border}; --band:${bandBackground}; --glow:${glowColor ?? "rgba(96,165,250,0.40)"};`}>

    <style>
      /* ============ STYLE CONSORTIUM (bande blanche + cartes noires) ============ */
      .card-surface{
        background: rgb(18,18,18);
        border: 1px solid rgba(0,0,0,0.14);
        box-shadow: 0 14px 40px rgba(0,0,0,0.18);
      }
      .hover-tint{
        background: radial-gradient(circle at 18% 18%,
          color-mix(in srgb, var(--accent) 16%, transparent),
          transparent 62%);
      }
      .card-icon{
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.10);
      }
      .soft-on-dark  { color: color-mix(in srgb, white 82%, transparent); }
      .muted-on-dark { color: color-mix(in srgb, white 70%, transparent); }
      .band-title { color: rgba(17,17,17,0.92); }
      .band-soft  { color: rgba(17,17,17,0.75); }
      .band-muted { color: rgba(17,17,17,0.62); }
      .focus-ring:focus { outline: none; box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 30%, transparent); }
      .icon-accent { color: var(--accent); }
    </style>

    <!-- HERO -->
    <section slot="hero" class="relative mx-auto max-w-4xl px-4 text-center z-20 pt-2 pb-10">
      <div
        class="pointer-events-none absolute left-1/2 top-8 -translate-x-1/2 w-[72%] md:w-[56%] h-24 blur-[80px] opacity-70"
        style="background: color-mix(in srgb, var(--accent) 18%, transparent);"
      ></div>

      <!--<img src={logo.src} alt="Le Consortium" class="h-20 w-auto mx-auto opacity-95" />-->
    <div slot="header" class="flex flex-col items-center">
      <img src={logo.src} alt="Consortium" class="h-32 md:h-36 w-auto" />
      <h1 class="mt-2 text-sm tracking-[0.35em] uppercase"
          style="color: color-mix(in srgb, var(--text) 60%, transparent);">
        Service conseil
      </h1>
    </div>

      <p class="mt-4 text-lg soft-on-dark">
        Un avis technique <span class="font-semibold">neutre</span> pour décider vite, éviter les mauvaises surprises,
        et investir au bon endroit.
        <span class="block mt-2 muted-on-dark">
          Soumissions • gouvernance • cybersécurité • Microsoft 365 • sauvegarde • architecture
        </span>
      </p>

      <div class="mt-6 flex flex-col sm:flex-row gap-3 justify-center">
        <a
          href="#demande"
          class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
          style="background: var(--accent); color: #111;"
        >
          Demander un appel
        </a>

        <a
          href="#inclus"
          class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
          style="background: color-mix(in srgb, var(--accent) 16%, transparent); color: var(--text); border: 1px solid color-mix(in srgb, var(--accent) 28%, transparent);"
        >
          Voir ce qui est inclus
        </a>
      </div>

      <div class="mt-6 flex flex-wrap gap-2 justify-center">
        <span class="px-3 py-1 rounded-full text-sm card-icon muted-on-dark">Décisions éclairées</span>
        <span class="px-3 py-1 rounded-full text-sm card-icon muted-on-dark">Risques & impacts</span>
        <span class="px-3 py-1 rounded-full text-sm card-icon muted-on-dark">Recommandations concrètes</span>
      </div>
    </section>
    <!-- FIXED BACK LINK -->
    <a
      href="/"
      class="backbtn fixed right-6 top-5 z-50 inline-flex items-center px-4 py-2 rounded-lg shadow-lg backdrop-blur transition-all"
      style="background: rgba(18,18,18,0.85); border: 1px solid rgba(255,255,255,0.10); color: color-mix(in srgb, white 90%, transparent);"
    >
      ← Retour à la page Services TI
    </a>
    <!-- CONTENT -->
    <!-- BAND (BLANC) -->
<section class="relative w-full overflow-hidden" style="background: var(--band);">
  <div class="h-[2px] w-full" style="background: var(--accent);"></div>
  <div class="h-14 w-full" style="background: linear-gradient(to bottom, color-mix(in srgb, var(--accent) 18%, transparent), transparent);"></div>
  <div class="absolute top-44 left-0 right-0 mx-auto w-[90%] h-44 blur-3xl z-0" style={`background-color: ${glowColor}; opacity: 0.22;`}></div>
  <div class="relative z-10">
    <main class="mx-auto max-w-6xl px-4 pb-20 pt-10 space-y-14">
<!-- BAND: POURQUOI -->
      <section id="pourquoi" class="mt-0">
        <div class="mx-auto max-w-6xl px-4">
          <div class="rounded-3xl bg-white p-8 md:p-10 shadow-xl border border-black/10">
            <h3 class="text-3xl font-semibold band-title">Pourquoi un service conseil?</h3>
            <p class="mt-3 text-lg band-soft max-w-3xl">
              Quand les budgets sont serrés, le plus coûteux ce n’est pas la meilleure solution —
              c’est la mauvaise décision. On vous aide à clarifier les options, mesurer les risques,
              et choisir une trajectoire réaliste.
            </p>

            <div class="mt-8 grid gap-4 md:grid-cols-3">
              <div class="rounded-2xl p-6 border border-black/10">
                <div class="flex items-start gap-3">
                  <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center">
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 20V10" /><path d="M18 20V4" /><path d="M6 20v-6" />
                    </svg>
                  </div>
                  <div>
                    <h4 class="text-lg font-semibold band-title">Comparer & trancher</h4>
                    <p class="mt-1 band-muted">
                      Soumissions, portée, exclusions, garanties, impacts opérationnels.
                    </p>
                  </div>
                </div>
              </div>

              <div class="rounded-2xl p-6 border border-black/10">
                <div class="flex items-start gap-3">
                  <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center">
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    </svg>
                  </div>
                  <div>
                    <h4 class="text-lg font-semibold band-title">Réduire les risques</h4>
                    <p class="mt-1 band-muted">
                      Validation d’architecture, cybersécurité de base, “quick wins”.
                    </p>
                  </div>
                </div>
              </div>

              <div class="rounded-2xl p-6 border border-black/10">
                <div class="flex items-start gap-3">
                  <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center">
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 11l19-9-9 19-2-8-8-2z" />
                    </svg>
                  </div>
                  <div>
                    <h4 class="text-lg font-semibold band-title">Aller plus vite</h4>
                    <p class="mt-1 band-muted">
                      Une trajectoire claire, validée avec la direction et les parties prenantes.
                    </p>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- SECTION: CE QUI EST INCLUS -->
      <section id="inclus" class="mt-14">
        <div class="mx-auto max-w-6xl px-4">
          <div class="flex items-end justify-between gap-4 flex-wrap">
            <div>
              <h3 class="text-3xl font-semibold" style="color: black;">Ce qui est inclus</h3>
              <p class="mt-2 muted-on-dark max-w-3xl" style="color: black;">
                Un service conseil, c’est de l’analyse, des recommandations et de l’accompagnement décisionnel — pas des opérations TI quotidiennes.
              </p>
            </div>
            <span class="px-3 py-1 rounded-full text-sm card-icon muted-on-dark" style="color: black;">Avis neutre • orienté décision</span>
          </div>

          <div class="mt-7 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            {inclus.map((item) => (
              <div class="relative rounded-2xl p-6 card-surface overflow-hidden">
                <div class="pointer-events-none absolute inset-0 hover-tint opacity-70"></div>
                <div class="relative">
                  <div class="flex items-start gap-3">
                    <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
                      <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5" />
                      </svg>
                    </div>
                    <div>
                      <h4 class="text-lg font-semibold soft-on-dark">{item.title}</h4>
                      <p class="mt-2 muted-on-dark">{item.desc}</p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>

      <!-- SECTION: NON INCLUS -->
      <section class="mt-10">
        <div class="mx-auto max-w-6xl px-4">
          <div class="rounded-3xl p-8 md:p-10 card-surface overflow-hidden relative">
            <div class="pointer-events-none absolute inset-0 hover-tint opacity-55"></div>
            <div class="relative">
              <h3 class="text-2xl font-semibold soft-on-dark">Ce qui n’est pas inclus</h3>
              <p class="mt-2 muted-on-dark max-w-3xl">
                Pour éviter toute ambiguïté : ces éléments relèvent plutôt des services gérés, du support, ou d’un projet d’implantation.
              </p>

              <ul class="mt-6 grid gap-3 md:grid-cols-2">
                {nonInclus.map((x) => (
                  <li class="flex items-start gap-3">
                    <span class="mt-1 h-5 w-5 rounded-full card-icon flex items-center justify-center shrink-0">
                      <svg class="h-4 w-4 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18" /><path d="M6 6l12 12" />
                      </svg>
                    </span>
                    <span class="muted-on-dark">{x}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: COMMENT ÇA FONCTIONNE -->
      <section class="mt-14">
        <div class="mx-auto max-w-6xl px-4">
          <h3 class="text-3xl font-semibold" style="color: black;">Comment ça fonctionne</h3>
          <p class="mt-2 muted-on-dark max-w-3xl" style="color: black;"">
            Simple, rapide, et orienté résultats. On s’adapte à votre réalité (OBNL, EÉSAD, coop, multi-sites).
          </p>

          <div class="mt-7 grid gap-4 md:grid-cols-3">
            {steps.map((s) => (
              <div class="rounded-2xl p-6 card-surface overflow-hidden relative">
                <div class="pointer-events-none absolute inset-0 hover-tint opacity-70"></div>
                <div class="relative">
                  <div class="flex items-start gap-3">
                    <div class="h-11 w-11 rounded-xl flex items-center justify-center font-bold"
                         style="background: color-mix(in srgb, var(--accent) 22%, transparent); color: var(--text); border: 1px solid color-mix(in srgb, var(--accent) 28%, transparent);">
                      {s.n}
                    </div>
                    <div>
                      <h4 class="text-lg font-semibold soft-on-dark">{s.t}</h4>
                      <p class="mt-2 muted-on-dark">{s.d}</p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>

      <!-- SECTION: LOI 25 / CONFORMITÉ -->
      <section class="mt-14">
        <div class="mx-auto max-w-6xl px-4">
          <div class="rounded-3xl bg-white p-8 md:p-10 shadow-xl border border-black/10">
            <div class="flex items-start gap-4">
              <div class="h-12 w-12 rounded-2xl flex items-center justify-center"
                   style="background: color-mix(in srgb, var(--accent) 18%, transparent); border: 1px solid color-mix(in srgb, var(--accent) 22%, transparent);">
                <svg class="h-6 w-6" style="color: rgba(17,17,17,0.92);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 19.5A2.5 2.5 0 0 0 6.5 22H20" />
                  <path d="M20 2H6.5A2.5 2.5 0 0 0 4 4.5v15" />
                  <path d="M8 6h9" /><path d="M8 10h9" /><path d="M8 14h9" />
                </svg>
              </div>
              <div>
                <h3 class="text-2xl font-semibold band-title">Loi 25 & bonnes pratiques</h3>
                <p class="mt-2 band-soft max-w-3xl">
                  Si votre demande touche la confidentialité, la sauvegarde, la sécurité ou le partage de données,
                  on intègre l’angle conformité (ex.: accès admin, MFA, partage externe, journalisation, politiques).
                </p>
                <p class="mt-3 band-muted max-w-3xl">
                  Objectif : réduire les angles morts et documenter clairement les décisions.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: DEMANDE -->
      <section id="demande" class="mt-14 pb-16">
        <div class="mx-auto max-w-6xl px-4">
          <div class="rounded-3xl p-8 md:p-10 card-surface overflow-hidden relative">
            <div class="pointer-events-none absolute inset-0 hover-tint opacity-60"></div>

            <div class="relative flex flex-col md:flex-row md:items-start md:justify-between gap-8">
              <div class="md:max-w-xl">
                <h3 class="text-3xl font-semibold soft-on-dark">Demander une consultation</h3>
                <p class="mt-2 muted-on-dark">
                  Décrivez brièvement votre besoin. On vous revient rapidement avec une proposition simple (portée, livrable, échéancier).
                </p>

                <div class="mt-6 flex flex-col sm:flex-row gap-3">
                  <button id="openFormBtn"
                    class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110 focus-ring"
                    style="background: var(--accent); color:#111;"
                    type="button"
                  >
                    Ouvrir le formulaire
                  </button>

                  <a href="#inclus"
                    class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
                    style="background: color-mix(in srgb, var(--accent) 16%, transparent); color: var(--text); border: 1px solid color-mix(in srgb, var(--accent) 28%, transparent);"
                  >
                    Revoir les inclusions
                  </a>
                </div>

                <p id="status" class="mt-4 text-sm muted-on-dark"></p>
              </div>

              <div class="md:flex-1">
                <div id="formContainer" class="overflow-hidden max-h-0 opacity-0 transition-all duration-500">
                  <div class="rounded-2xl p-6 md:p-7"
                       style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.10);">
                    <div class="flex items-center justify-between gap-4">
                      <h4 class="text-xl font-semibold soft-on-dark">Demande – Service conseil TI</h4>
                      <button id="closeFormBtn" type="button" class="px-3 py-2 rounded-lg card-icon muted-on-dark hover:brightness-110 focus-ring">
                        Fermer
                      </button>
                    </div>

                    <form id="consultForm" class="mt-4 space-y-4">
                      <div>
                        <label class="block text-sm font-medium muted-on-dark">Organisation</label>
                        <input type="text" name="conseil_org" required
                          class="mt-1 w-full rounded-lg px-3 py-2 bg-white/10 border border-white/20 placeholder-white/30 text-white focus-ring"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium muted-on-dark">Courriel</label>
                        <input type="email" name="conseil_email" required
                          class="mt-1 w-full rounded-lg px-3 py-2 bg-white/10 border border-white/20 placeholder-white/30 text-white focus-ring"
                        />
                      </div>

                      <div class="grid md:grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium muted-on-dark">Téléphone (optionnel)</label>
                          <input type="tel" name="conseil_tel"
                            class="mt-1 w-full rounded-lg px-3 py-2 bg-white/10 border border-white/20 placeholder-white/30 text-white focus-ring"
                          />
                        </div>

                        <div>
                          <label class="block text-sm font-medium muted-on-dark">Type de demande</label>
                          <select name="conseil_type" required
                            class="mt-1 w-full rounded-lg px-3 py-2 bg-white/10 border border-white/20 text-white focus-ring"
                          >
                            <option value="Soumission">Soumission / devis</option>
                            <option value="Stratégie">Stratégie TI</option>
                            <option value="Cybersécurité">Cybersécurité</option>
                            <option value="Microsoft 365">Microsoft 365</option>
                            <option value="Sauvegarde">Sauvegarde</option>
                            <option value="Autre">Autre</option>
                          </select>
                        </div>
                      </div>

                      <div>
                        <label class="block text-sm font-medium muted-on-dark">Message</label>
                        <textarea name="conseil_msg" rows="4" required
                          class="mt-1 w-full rounded-lg px-3 py-2 bg-white/10 border border-white/20 placeholder-white/30 text-white focus-ring"
                        ></textarea>
                      </div>

                      <button type="submit"
                        class="w-full inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110 focus-ring"
                        style="background: var(--accent); color:#111;"
                      >
                        Envoyer
                      </button>

                      <p class="text-xs muted-on-dark">
                        En envoyant, vous acceptez que nous vous recontactions au sujet de cette demande.
                      </p>
                    </form>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</section>
</div>
</SiteLayout>

<script>
  const btn = document.getElementById("openFormBtn");
  const closeBtn = document.getElementById("closeFormBtn");
  const panel = document.getElementById("formContainer");
  const form = document.getElementById("consultForm");
  const status = document.getElementById("status");

  if (btn && closeBtn && panel && form && status) {
    btn.addEventListener("click", () => {
      panel.style.maxHeight = panel.scrollHeight + "px";
      panel.style.opacity = "1";
      panel.scrollIntoView({ behavior: "smooth", block: "start" });
    });

    closeBtn.addEventListener("click", () => {
      panel.style.maxHeight = "0";
      panel.style.opacity = "0";
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const fd = new FormData(form);
      const data = {};
      for (const [k, v] of fd.entries()) data[k] = v;

      status.textContent = "Envoi…";

      try {
        const res = await fetch("/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        if (res.ok) {
          status.textContent = "Demande envoyée!";
          form.reset();
        } else {
          status.textContent = "Erreur d’envoi.";
        }
      } catch (err) {
        status.textContent = "Erreur réseau.";
      }
    });
  }
</script>
