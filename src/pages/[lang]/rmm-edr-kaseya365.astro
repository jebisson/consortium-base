---
import SiteLayout from "../../layouts/SiteLayout.astro";
import { t } from "../../i18n/utils";
import { tenant } from "../../config/tenant";

export const prerender = true;
export function getStaticPaths() {
  return [{ params: { lang: "fr" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params as { lang: string };
const tr = t(lang);
const r = tr.rmm;
const common = tr.common;
const homeLink = `/${lang}`;
const currentPath = `/${lang}/rmm-edr-kaseya365`;
const { accent } = tenant.colors;
---

<SiteLayout title={r.title} lang={lang} currentPath={currentPath}>
  <style>
    .card-dark {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 14px 40px rgba(0,0,0,0.22);
      border-radius: 1rem;
    }
    .hover-tint {
      background: radial-gradient(circle at 18% 18%, color-mix(in srgb, var(--accent) 16%, transparent), transparent 62%);
      position: absolute; inset: 0; pointer-events: none; opacity: 0.70; transition: opacity 0.3s;
    }
    .soft { color: color-mix(in srgb, white 82%, transparent); }
    .muted { color: color-mix(in srgb, white 68%, transparent); }
    .band-title { color: rgba(17,17,17,0.92); }
    .band-soft  { color: rgba(17,17,17,0.76); }
    .band-muted { color: rgba(17,17,17,0.62); }
    .icon-accent { color: var(--accent); }
    .card-icon {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .pill {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.92);
    }
  </style>

  <!-- HEADER -->
  <div slot="header" class="flex flex-col items-center">
    <img src={tenant.logoSrc} alt={tenant.name} class="h-28 md:h-36 w-auto drop-shadow-lg" />
    <p class="mt-3 text-xs tracking-[0.35em] uppercase"
       style="color: color-mix(in srgb, var(--text) 55%, transparent);">{r.headerSubtitle}</p>
  </div>

  <!-- HERO -->
  <section slot="hero" class="relative max-w-4xl mx-auto px-4 text-center z-20 pt-2 pb-10">
    <div class="pointer-events-none absolute left-1/2 top-8 -translate-x-1/2 w-[65%] h-24 blur-[80px] opacity-60"
         style="background: color-mix(in srgb, var(--accent) 20%, transparent);"></div>
    <h1 class="mt-4 text-4xl md:text-5xl font-bold tracking-tight animate-fade-up" style="color: var(--text);">
      {r.heroTitle}
    </h1>
    <p class="mt-4 text-lg soft animate-fade-up animate-fade-up-delay-1">{r.heroDesc}</p>
    <div class="mt-6 flex flex-col sm:flex-row gap-3 justify-center animate-fade-up animate-fade-up-delay-2">
      <a href="#forfaits"
         class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
         style="background: var(--accent); color: #111;">{r.ctaPlans}</a>
      <a href="#soumission"
         class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
         style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: rgba(255,255,255,0.92);">
        {r.ctaQuote}</a>
    </div>
    <div class="mt-8 flex flex-wrap gap-2 justify-center animate-fade-up animate-fade-up-delay-3">
      {r.pills.map((p) => (
        <a href={p.href} class="pill px-4 py-2 rounded-full text-sm transition">{p.label}</a>
      ))}
    </div>
  </section>

  <!-- BACK -->

  <!-- BAND -->
  <section class="relative w-full overflow-hidden" style="background: var(--band);">
    <div class="h-[2px] w-full" style="background: var(--accent);"></div>
    <div class="h-12 w-full"
         style="background: linear-gradient(to bottom, color-mix(in srgb, var(--accent) 16%, transparent), transparent);"></div>

    <div class="relative mx-auto max-w-6xl px-4 pb-20 space-y-16">

      <!-- Intro -->
      <section class="grid md:grid-cols-2 gap-10 pt-10">
        <div class="reveal">
          <h3 class="text-2xl font-semibold band-title">{r.introTitle}</h3>
          <p class="mt-3 band-soft leading-relaxed">{r.introDesc}</p>
          <ul class="mt-4 list-disc ml-6 space-y-2 band-soft">
            {r.introBullets.map((b) => <li>{b}</li>)}
          </ul>
        </div>
        <div class="grid gap-4">
          {r.introCards.map((c, i) => (
            <div class="group relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative flex items-start gap-4">
                <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
                  {i === 0 && (
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                    </svg>
                  )}
                  {i === 1 && (
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  )}
                  {i === 2 && (
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                  )}
                </div>
                <div>
                  <p class="font-semibold" style="color: white;">{c.title}</p>
                  <p class="mt-1 muted text-sm">{c.desc}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- RMM -->
      <section id="rmm" class="space-y-6">
        <div class="flex items-baseline justify-between gap-6 flex-wrap reveal">
          <h3 class="text-2xl font-semibold band-title">{r.rmm.title}</h3>
          <span class="text-sm band-muted">{r.rmm.subtitle}</span>
        </div>
        <div class="grid md:grid-cols-3 gap-6">
          {r.rmm.cards.map((c) => (
            <div class="group relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative flex items-start gap-3">
                <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
                  <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                  </svg>
                </div>
                <div>
                  <h4 class="text-lg font-semibold" style="color: var(--accent);">{c.title}</h4>
                  <p class="mt-2 soft text-sm">{c.desc}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- EDR -->
      <section id="edr" class="space-y-6">
        <div class="flex items-baseline justify-between gap-6 flex-wrap reveal">
          <h3 class="text-2xl font-semibold band-title">{r.edr.title}</h3>
          <span class="text-sm band-muted">{r.edr.subtitle}</span>
        </div>
        <div class="grid md:grid-cols-3 gap-6">
          {r.edr.cards.map((c) => (
            <div class="group relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative">
                <h4 class="text-lg font-semibold" style="color: var(--accent);">{c.title}</h4>
                <p class="mt-2 soft text-sm">{c.desc}</p>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- K365 -->
      <section id="k365" class="space-y-6">
        <div class="flex items-baseline justify-between gap-6 flex-wrap reveal">
          <h3 class="text-2xl font-semibold band-title">{r.k365.title}</h3>
          <span class="text-sm band-muted">{r.k365.subtitle}</span>
        </div>
        <div class="grid md:grid-cols-3 gap-6">
          {r.k365.cards.map((c) => (
            <div class="group relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative">
                <h4 class="text-lg font-semibold" style="color: var(--accent);">{c.title}</h4>
                <p class="mt-2 soft text-sm">{c.desc}</p>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- Plans -->
      <section id="forfaits" class="space-y-8">
        <div class="text-center reveal">
          <h3 class="text-xs uppercase tracking-[0.25em] band-muted">{r.plansTitle}</h3>
          <p class="mt-2 band-soft">{r.plansSubtitle}</p>
        </div>
        <div class="grid md:grid-cols-3 gap-8">
          {r.plans.map((plan) => (
            <div class="group relative overflow-hidden rounded-2xl p-8 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative">
                <h4 class="text-xl font-semibold" style="color: white;">{plan.title}</h4>
                <p class="mt-2 muted">{plan.subtitle}</p>
                <p class="mt-5">
                  <span class="font-extrabold text-5xl" style="color: white;">{plan.price}</span>
                  <span class="muted"> / user / mo</span>
                </p>
                <ul class="mt-6 list-disc ml-6 space-y-2 soft text-sm">
                  {plan.bullets.map((b) => <li>{b}</li>)}
                </ul>
                <a href="#soumission"
                   class="mt-7 inline-flex items-center justify-center w-full px-5 py-3 rounded-xl font-semibold transition hover:brightness-110"
                   style="background: var(--accent); color: #111;">
                  {common.requestQuote}
                </a>
              </div>
            </div>
          ))}
        </div>

      </section>

      <!-- Comparison table -->
      <section id="comparatif" class="space-y-6 reveal">
        <h3 class="text-2xl font-semibold band-title">{r.compTitle}</h3>
        <div class="rounded-2xl overflow-hidden card-dark">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead style="background: rgba(255,255,255,0.06);">
                <tr class="text-white/80">
                  {r.compHeaders.map((h) => (
                    <th class="text-left px-5 py-4 font-semibold">{h}</th>
                  ))}
                </tr>
              </thead>
              <tbody class="soft">
                {r.compRows.map(([f, a, b, c]) => (
                  <tr style="border-top: 1px solid rgba(255,255,255,0.08);">
                    <td class="px-5 py-4">{f}</td>
                    {[a, b, c].map((val) => (
                      <td class="px-5 py-4">
                        {val === "âœ…" ? (
                          <svg class="h-5 w-5 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M20 6L9 17l-5-5"/>
                          </svg>
                        ) : (
                          <span class="muted">{val}</span>
                        )}
                      </td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Quote form -->
      <section id="soumission">
        <div class="rounded-2xl p-10 card-dark relative overflow-hidden reveal">
          <div class="pointer-events-none absolute inset-0 opacity-40"
               style="background: radial-gradient(circle at 20% 20%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 60%);"></div>
          <div class="relative">
            <h4 class="text-3xl font-semibold mb-3" style="color: white;">{r.quoteTitle}</h4>
            <p class="soft mb-6">{r.quoteDesc}</p>
            <button id="openQuoteBtn"
                    class="inline-flex items-center justify-center px-7 py-3 rounded-xl font-semibold transition hover:brightness-110"
                    style="background: var(--accent); color: #111;">{r.quoteOpenBtn}</button>

            <div id="quoteFormContainer" class="overflow-hidden max-h-0 opacity-0 transition-all duration-500 mt-6">
              <form id="quoteForm" class="space-y-4 p-6 rounded-xl"
                    style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10);">
                <h5 class="text-xl font-semibold mb-2" style="color: white;">{r.formTitle}</h5>

                <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{common.orgName}</label>
                <input type="text" name="quote_org" required class="w-full rounded-lg px-3 py-2"
                       style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />

                <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{common.email}</label>
                <input type="email" name="quote_email" required class="w-full rounded-lg px-3 py-2"
                       style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />

                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{r.formUsersLabel}</label>
                    <input type="number" name="quote_users" min="1" required class="w-full rounded-lg px-3 py-2"
                           style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{common.phone} {common.optional}</label>
                    <input type="text" name="quote_phone" class="w-full rounded-lg px-3 py-2"
                           style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />
                  </div>
                </div>

                <h6 class="text-sm font-semibold mt-2" style="color: rgba(255,255,255,0.92);">{r.formServicesLabel}</h6>
                <div class="grid md:grid-cols-2 gap-3 text-sm soft">
                  {r.formServices.map((svc) => (
                    <label class="flex items-center gap-2">
                      <input type="checkbox" name={svc.name} value="yes" style={`accent-color: ${accent};`} />
                      {svc.label}
                    </label>
                  ))}
                </div>

                <label class="block text-sm font-medium mt-2" style="color: rgba(255,255,255,0.92);">{r.formNotesLabel}</label>
                <textarea name="quote_notes" rows="4" class="w-full rounded-lg px-3 py-2"
                          style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;"
                          placeholder={r.formNotesPh}></textarea>

                <button type="submit" class="mt-4 w-full px-4 py-2 rounded-lg font-semibold transition hover:brightness-110"
                        style="background: var(--accent); color: #111;">{common.sendRequest}</button>
                <button type="button" id="closeQuoteBtn" class="w-full px-4 py-2 rounded-lg font-medium transition hover:brightness-110"
                        style="background: rgba(255,255,255,0.06); color: white; border: 1px solid rgba(255,255,255,0.10);">{common.close}</button>
                <p id="quoteStatus" class="text-sm mt-2 soft"></p>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- Compliance -->
      <section class="relative overflow-hidden rounded-2xl p-8 card-dark reveal">
        <div class="hover-tint"></div>
        <div class="relative flex items-start gap-4">
          <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
            <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 0 6.5 22H20"/><path d="M20 2H6.5A2.5 2.5 0 0 0 4 4.5v15"/><path d="M8 6h9"/><path d="M8 10h9"/><path d="M8 14h9"/>
            </svg>
          </div>
          <div>
            <h4 class="text-xl font-semibold mb-2" style="color: white;">{r.compliance.title}</h4>
            <p class="soft leading-relaxed">{r.compliance.desc}</p>
          </div>
        </div>
      </section>

    </div>
  </section>

</SiteLayout>

<script define:vars={{ msgSending: tr.common.sending, msgDone: tr.common.sent, msgError: tr.common.errorSend, msgNetwork: tr.common.errorNetwork }}>
  const btn = document.getElementById("openQuoteBtn");
  const closeBtn = document.getElementById("closeQuoteBtn");
  const panel = document.getElementById("quoteFormContainer");
  const form = document.getElementById("quoteForm");
  const status = document.getElementById("quoteStatus");

  if (btn && closeBtn && panel && form && status) {
    btn.addEventListener("click", () => {
      panel.style.maxHeight = panel.scrollHeight + "px";
      panel.style.opacity = "1";
      panel.scrollIntoView({ behavior: "smooth", block: "start" });
    });
    closeBtn.addEventListener("click", () => {
      panel.style.maxHeight = "0";
      panel.style.opacity = "0";
    });
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const data = {};
      for (const [k, v] of fd.entries()) data[k] = v;
      status.textContent = msgSending;
      try {
        const res = await fetch("/api/submit", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data) });
        status.textContent = res.ok ? msgDone : msgError;
        if (res.ok) form.reset();
      } catch { status.textContent = msgNetwork; }
    });
  }
</script>
