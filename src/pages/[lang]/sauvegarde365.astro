---
import SiteLayout from "../../layouts/SiteLayout.astro";
import { t } from "../../i18n/utils";
import { tenant } from "../../config/tenant";

export const prerender = true;
export function getStaticPaths() {
  return [
    { params: { lang: "fr" } },
    { params: { lang: "en" } },
  ];
}

const { lang } = Astro.params as { lang: string };
const tr = t(lang);
const b = tr.backup;
const common = tr.common;
const { accent } = tenant.colors;

const homeLink = `/${lang}`;
const currentPath = lang === "fr" ? "/fr/sauvegarde365" : "/en/backup365";
---

<SiteLayout title={b.title} lang={lang} currentPath={currentPath}>

  <style>
    .card-dark {
      background: rgb(18,18,18);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 14px 40px rgba(0,0,0,0.22);
      border-radius: 1rem;
      backdrop-filter: blur(8px);
    }
    .hover-tint {
      background: radial-gradient(circle at 18% 18%, color-mix(in srgb, var(--accent) 16%, transparent), transparent 62%);
      position: absolute; inset: 0; pointer-events: none; opacity: 0.70;
      transition: opacity 0.3s;
    }
    .soft { color: color-mix(in srgb, white 82%, transparent); }
    .muted { color: color-mix(in srgb, white 68%, transparent); }
    .band-title { color: rgba(17,17,17,0.92); }
    .band-soft  { color: rgba(17,17,17,0.76); }
    .band-muted { color: rgba(17,17,17,0.60); }
    .icon-accent { color: var(--accent); }
    .card-icon {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .pill {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.92);
    }
  </style>

  <!-- HEADER -->
  <div slot="header" class="flex flex-col items-center">
    <img src={tenant.logoSrc} alt={tenant.name} class="h-28 md:h-36 w-auto drop-shadow-lg" />
    <p class="mt-3 text-xs tracking-[0.35em] uppercase"
       style="color: color-mix(in srgb, var(--text) 55%, transparent);">
      {b.headerSubtitle}
    </p>
  </div>

  <!-- HERO -->
  <section slot="hero" class="relative max-w-4xl mx-auto px-4 text-center z-20 pt-2 pb-10">
    <div class="pointer-events-none absolute left-1/2 top-8 -translate-x-1/2 w-[65%] h-24 blur-[80px] opacity-60"
         style="background: color-mix(in srgb, var(--accent) 20%, transparent);"></div>

    <h1 class="mt-4 text-4xl md:text-5xl font-bold tracking-tight animate-fade-up" style="color: var(--text);">
      {b.heroTitle}
    </h1>
    <p class="mt-4 text-lg soft animate-fade-up animate-fade-up-delay-1">
      {b.heroDesc}
      <span class="block mt-1">{b.heroDescLine2}</span>
    </p>

    <div class="mt-6 flex flex-col sm:flex-row gap-3 justify-center animate-fade-up animate-fade-up-delay-2">
      <a href="#activer"
         class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
         style="background: var(--accent); color: #111;">
        {b.ctaActivate}
      </a>
      <a href="#pourquoi"
         class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
         style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); color: rgba(255,255,255,0.92);">
        {b.ctaWhy}
      </a>
    </div>

    <div class="mt-6 flex flex-wrap gap-2 justify-center animate-fade-up animate-fade-up-delay-3">
      {b.pills.map((p) => (
        <span class="pill px-3 py-2 rounded-xl text-sm">{p}</span>
      ))}
    </div>
  </section>

  <!-- BACK LINK -->

  <!-- BAND (white) -->
  <section class="relative w-full overflow-hidden" style="background: var(--band);">
    <div class="h-[2px] w-full" style="background: var(--accent);"></div>
    <div class="h-12 w-full"
         style="background: linear-gradient(to bottom, color-mix(in srgb, var(--accent) 16%, transparent), transparent);"></div>

    <div class="relative z-10 mx-auto max-w-6xl px-4 pb-20 pt-8 space-y-14">

      <!-- WHY -->
      <div id="pourquoi" class="text-center reveal">
        <h3 class="band-muted text-xs uppercase tracking-[0.25em]">{b.whyTitle}</h3>
        <p class="mt-4 text-2xl md:text-3xl font-semibold band-title">{b.whySubtitle}</p>
      </div>

      <!-- WHY GRID -->
      <section class="grid md:grid-cols-2 gap-10">
        <!-- Left: risks -->
        <div class="space-y-6">
          <div class="group relative overflow-hidden p-6 card-dark reveal">
            <div class="hover-tint"></div>
            <div class="relative">
              <p class="text-xl leading-relaxed font-semibold" style="color: rgba(255,255,255,0.95);">
                {b.marketingTitle}
              </p>
              <p class="mt-3 soft text-base leading-relaxed">{b.marketingDesc}</p>
              <div class="mt-4 inline-flex items-center gap-2 px-3 py-2 rounded-xl pill text-sm">
                {b.marketingBadge}
              </div>
            </div>
          </div>

          <div class="grid sm:grid-cols-2 gap-4">
            {b.risks.slice(0,4).map((r) => (
              <div class="relative overflow-hidden flex gap-3 p-4 rounded-xl card-dark reveal">
                <div class="hover-tint"></div>
                <div class="relative flex gap-3 w-full">
                  <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><path d="M12 9v4m0 4h.01"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-semibold" style="color: rgba(255,255,255,0.92);">{r.title}</p>
                    <p class="text-sm soft">{r.desc}</p>
                  </div>
                </div>
              </div>
            ))}
            {b.risks[4] && (
              <div class="relative overflow-hidden flex gap-3 p-4 rounded-xl card-dark sm:col-span-2 reveal">
                <div class="hover-tint"></div>
                <div class="relative flex gap-3 w-full">
                  <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
                    <svg class="h-6 w-6 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><path d="M12 9v4m0 4h.01"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-semibold" style="color: rgba(255,255,255,0.92);">{b.risks[4].title}</p>
                    <p class="text-sm soft">{b.risks[4].desc}</p>
                  </div>
                </div>
              </div>
            )}
          </div>

          <a href="#activer" class="inline-flex items-center gap-2 text-sm font-semibold band-title hover:opacity-80 transition">
            {b.ctaActivate} â†’
          </a>
        </div>

        <!-- Right: benefits -->
        <div class="grid grid-cols-1 gap-6">
          <div class="relative overflow-hidden p-6 rounded-2xl card-dark reveal">
            <div class="hover-tint"></div>
            <div class="relative">
            <p class="font-semibold text-lg" style="color: rgba(255,255,255,0.92);">{b.benefitsTitle}</p>
            <p class="mt-2 soft leading-relaxed">{b.benefitsDesc}</p>
            <div class="mt-4 space-y-3">
              {b.benefits.map((bv) => (
                <div class="flex items-start gap-3">
                  <div class="h-9 w-9 rounded-xl card-icon flex items-center justify-center shrink-0">
                    <svg class="h-5 w-5 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 6L9 17l-5-5"/>
                    </svg>
                  </div>
                  <p class="soft pt-1"><span class="font-semibold">{bv.title}</span>{bv.desc}</p>
                </div>
              ))}
            </div>
            </div>
          </div>

          <div class="flex items-start gap-4 p-6 rounded-2xl card-dark reveal">
            <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
              <svg class="h-6 w-6 icon-accent" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
              </svg>
            </div>
            <div>
              <p class="font-semibold text-lg" style="color: rgba(255,255,255,0.92);">{b.protection.title}</p>
              <p class="soft mt-1 leading-relaxed">{b.protection.desc}</p>
            </div>
          </div>

          <div class="flex items-start gap-4 p-6 rounded-2xl card-dark reveal">
            <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
              <svg class="h-6 w-6 icon-accent" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M4 19.5A2.5 2.5 0 0 0 6.5 22H20"/><path d="M20 2H6.5A2.5 2.5 0 0 0 4 4.5v15"/><path d="M8 6h9"/><path d="M8 10h9"/><path d="M8 14h9"/>
              </svg>
            </div>
            <div>
              <p class="font-semibold text-lg" style="color: rgba(255,255,255,0.92);">{b.restore.title}</p>
              <p class="soft mt-1 leading-relaxed">{b.restore.desc}</p>
            </div>
          </div>
        </div>
      </section>

      <!-- HOW IT WORKS -->
      <section class="space-y-8 reveal">
        <h4 class="text-2xl font-semibold band-title">{b.howTitle}</h4>
        <div class="grid md:grid-cols-3 gap-6">
          {b.steps.map((s, i) => (
            <div class="relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative flex items-start gap-3">
                <div class="h-11 w-11 rounded-xl flex items-center justify-center font-bold shrink-0"
                     style="background: color-mix(in srgb, var(--accent) 22%, transparent); color: var(--accent); border: 1px solid color-mix(in srgb, var(--accent) 28%, transparent);">
                  {i + 1}
                </div>
                <div>
                  <p class="font-semibold text-lg" style="color: rgba(255,255,255,0.92);">{s.title}</p>
                  <p class="soft mt-2 text-sm leading-relaxed">{s.desc}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- COMPLIANCE -->
      <section class="reveal">
        <div class="rounded-2xl p-6 bg-white shadow-sm border border-black/10">
          <div class="flex items-start gap-4">
            <div class="h-11 w-11 rounded-xl flex items-center justify-center shrink-0"
                 style="background: color-mix(in srgb, var(--accent) 18%, transparent); border: 1px solid color-mix(in srgb, var(--accent) 22%, transparent);">
              <svg class="h-6 w-6 icon-accent" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
              </svg>
            </div>
            <div>
              <h4 class="text-xl font-semibold mb-2 band-title">{b.complianceTitle}</h4>
              <p class="leading-relaxed band-soft">{b.complianceDesc}</p>
            </div>
          </div>
        </div>
      </section>

      <!-- INCLUDED -->
      <section class="space-y-8">
        <h4 class="text-2xl font-semibold band-title reveal">{b.includedTitle}</h4>
        <div class="grid md:grid-cols-3 gap-6">
          {b.included.map((inc) => (
            <div class="relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative flex items-start gap-3">
                <div class="h-11 w-11 rounded-xl card-icon flex items-center justify-center shrink-0">
                  <svg class="h-6 w-6 icon-accent" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M20 6L9 17l-5-5"/>
                  </svg>
                </div>
                <div>
                  <h5 class="font-semibold text-lg mb-2" style="color: rgba(255,255,255,0.92);">{inc.title}</h5>
                  <p class="soft text-sm">{inc.desc}</p>
                </div>
              </div>
            </div>
          ))}
        </div>

        <h4 class="text-2xl font-semibold band-title reveal">{b.whyDattoTitle}</h4>
        <p class="leading-relaxed band-soft reveal">{b.whyDattoDesc}</p>

        <div class="mt-6 grid md:grid-cols-2 gap-4">
          {b.dattoPoints.map((dp) => (
            <div class="relative overflow-hidden p-5 rounded-2xl card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative flex items-start gap-3">
                <div class="h-9 w-9 rounded-xl card-icon flex items-center justify-center shrink-0">
                  <svg class="h-5 w-5 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                  </svg>
                </div>
                <div>
                  <p class="font-semibold" style="color: rgba(255,255,255,0.92);">{dp.title}</p>
                  <p class="soft text-sm mt-1">{dp.desc}</p>
                </div>
              </div>
            </div>
          ))}
        </div>

        <!-- FAQ -->
        <h4 class="text-2xl font-semibold band-title reveal">{b.faqTitle}</h4>
        <div class="grid md:grid-cols-2 gap-6">
          {b.faq.map((faq) => (
            <div class="relative overflow-hidden rounded-2xl p-6 card-dark reveal">
              <div class="hover-tint"></div>
              <div class="relative flex items-start gap-3">
                <div class="h-9 w-9 rounded-xl card-icon flex items-center justify-center shrink-0">
                  <svg class="h-5 w-5 icon-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3m.08 4h.01"/>
                  </svg>
                </div>
                <div>
                  <p class="font-semibold" style="color: rgba(255,255,255,0.92);">{faq.q}</p>
                  <p class="soft text-sm mt-2 leading-relaxed">{faq.a}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- PRICING + FORM -->
      <div id="activer"></div>
      <div class="rounded-2xl p-10 card-dark relative overflow-hidden reveal"
           style={`background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 58%, rgb(18,18,18)), rgb(18,18,18)); border: 1px solid rgba(255,255,255,0.10);`}>
        <div class="pointer-events-none absolute inset-0"
             style="background: radial-gradient(circle at 18% 18%, color-mix(in srgb, var(--accent) 14%, transparent), transparent 62%);"></div>

        <div class="relative">
          <h4 class="text-3xl font-bold mb-2" style="color: white;">{b.pricingTitle}</h4>
          <p class="mb-6" style="color: rgba(255,255,255,0.88);">{b.pricingDesc}</p>

          <p class="text-xl mb-6">
            <span class="font-extrabold text-5xl" style="color: white;">{b.pricingAmount}</span>
            <span style="color: rgba(255,255,255,0.85);"> {b.pricingUnit}</span>
          </p>

          <ul class="list-disc ml-6 space-y-2 text-lg mb-8" style="color: rgba(255,255,255,0.90);">
            {b.pricingBullets.map((bullet) => <li>{bullet}</li>)}
          </ul>

          <button id="openFormBtn"
                  class="inline-flex justify-center items-center mt-2 px-8 py-3 rounded-xl font-semibold bg-white text-black hover:bg-slate-100 transition">
            {b.activateBtn}
          </button>

          <!-- HIDDEN FORM -->
          <div id="activationFormContainer" class="overflow-hidden max-h-0 opacity-0 transition-all duration-500 mt-6">
            <form id="activationForm" class="space-y-4 bg-white/10 backdrop-blur p-6 rounded-xl border border-white/20">
              <h5 class="text-xl font-semibold mb-2" style="color: white;">{b.formTitle}</h5>

              <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{common.orgName}</label>
              <input type="text" name="activation_org" required
                     class="w-full rounded-lg px-3 py-2 bg-white/20 border border-white/30 text-white focus:ring-2 focus:ring-white" />

              <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{common.email}</label>
              <input type="email" name="activation_email" required
                     class="w-full rounded-lg px-3 py-2 bg-white/20 border border-white/30 text-white focus:ring-2 focus:ring-white" />

              <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">{b.formUsers}</label>
              <input type="number" name="activation_users" required
                     class="w-full rounded-lg px-3 py-2 bg-white/20 border border-white/30 text-white focus:ring-2 focus:ring-white" />

              <button type="submit"
                      class="mt-4 w-full px-4 py-2 bg-white text-black rounded-lg font-semibold hover:bg-slate-100 transition">
                {b.formSendBtn}
              </button>
              <button type="button" id="closeFormBtn"
                      class="mt-2 w-full px-4 py-2 bg-white/10 text-white rounded-lg font-medium border border-white/20 hover:bg-white/20 transition">
                {common.close}
              </button>

              <p id="activationStatus" class="text-sm mt-2" style="color: rgba(255,255,255,0.80);"></p>
            </form>
          </div>
        </div>
      </div>

    </div>
  </section>

</SiteLayout>

<script define:vars={{ msgSent: tr.backup.formSendBtn, msgSending: tr.common.sending, msgDone: tr.common.sent, msgError: tr.common.errorSend, msgNetwork: tr.common.errorNetwork }}>
  const btn = document.getElementById("openFormBtn");
  const closeBtn = document.getElementById("closeFormBtn");
  const panel = document.getElementById("activationFormContainer");
  const form = document.getElementById("activationForm");
  const status = document.getElementById("activationStatus");

  if (btn && closeBtn && panel && form && status) {
    btn.addEventListener("click", () => {
      panel.style.maxHeight = panel.scrollHeight + "px";
      panel.style.opacity = "1";
      panel.scrollIntoView({ behavior: "smooth", block: "start" });
    });
    closeBtn.addEventListener("click", () => {
      panel.style.maxHeight = "0";
      panel.style.opacity = "0";
    });
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const data = {};
      for (const [k, v] of fd.entries()) data[k] = v;
      status.textContent = msgSending;
      try {
        const res = await fetch("/api/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        status.textContent = res.ok ? msgDone : msgError;
        if (res.ok) form.reset();
      } catch {
        status.textContent = msgNetwork;
      }
    });
  }
</script>
