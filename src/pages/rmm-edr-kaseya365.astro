---
import SiteLayout from "../layouts/SiteLayout.astro";
import "../styles/global.css";
import logo from "../assets/consortium.png";
import { theme } from "../config/theme.js";

const { background, text, accent, border, bandBackground, glowcolor } = theme.colors;
---

<SiteLayout title="Datto RMM, Datto EDR & Kaseya 365 ‚Äì Consortium">
  <div style={`--bg:${background}; --text:${text}; --accent:${accent}; --border:${border}; --band:${bandBackground};`}>

    <style>
      /* ============ STYLE INDEX-LIKE (bande blanche + cartes noires) ============ */
      .card-surface{
        background: rgb(18,18,18);
        border: 1px solid rgba(0,0,0,0.14);
        box-shadow: 0 14px 40px rgba(0,0,0,0.18);
      }
      .hover-tint{
        background: radial-gradient(circle at 18% 18%,
          color-mix(in srgb, var(--accent) 16%, transparent),
          transparent 62%);
      }
      .muted-on-dark{ color: color-mix(in srgb, white 70%, transparent); }
      .soft-on-dark { color: color-mix(in srgb, white 82%, transparent); }

      /* Texte sur la bande blanche */
      .band-title{ color: rgba(17,17,17,0.92); }
      .band-soft { color: rgba(17,17,17,0.76); }
      .band-muted{ color: rgba(17,17,17,0.62); }

      .pill{
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.10);
        color: rgba(255,255,255,0.92);
      }
      .pill:hover{
        border-color: color-mix(in srgb, var(--accent) 65%, transparent);
        filter: brightness(1.06);
      }

      .backbtn:hover{
        border-color: color-mix(in srgb, var(--accent) 65%, transparent);
        filter: brightness(1.06);
      }
    </style>

    <!-- HEADER SLOT -->
    <div slot="header" class="flex flex-col items-center">
      <img src={logo.src} alt="Consortium" class="h-32 md:h-36 w-auto" />
      <h1 class="mt-2 text-sm tracking-[0.35em] uppercase"
          style="color: color-mix(in srgb, var(--text) 60%, transparent);">
        Supervision & Cybers√©curit√©
      </h1>
    </div>

    <!-- HERO SLOT (dark, simple, glow discret comme index) -->
    <section slot="hero" class="relative mx-auto max-w-4xl px-4 text-center z-20 pt-2 pb-10">
      <div
        class="pointer-events-none absolute left-1/2 top-8 -translate-x-1/2 w-[70%] md:w-[55%] h-24 blur-[80px] opacity-70"
        style="background: color-mix(in srgb, var(--accent) 18%, transparent);"
      ></div>

      <h2 class="mt-5 text-4xl md:text-5xl font-semibold tracking-tight" style="color: var(--text);">
        Datto RMM, Datto EDR & Kaseya 365
      </h2>

      <p class="mt-4 text-lg soft-on-dark">
        Une approche proactive : surveiller, corriger, d√©tecter et r√©pondre ‚Äî pour r√©duire les pannes
        et bloquer les menaces modernes.
      </p>

      <div class="mt-6 flex flex-col sm:flex-row gap-3 justify-center">
        <a
          href="#forfaits"
          class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
          style="background: var(--accent); color: #111;"
        >
          Voir les forfaits
        </a>

        <a
          href="#soumission"
          class="inline-flex items-center justify-center px-6 py-3 rounded-xl font-semibold transition hover:brightness-110"
          style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: rgba(255,255,255,0.92);"
        >
          Demande de soumission
        </a>
      </div>

      <!-- Anchor pills -->
      <div class="mt-8 flex flex-wrap gap-2 justify-center">
        <a href="#rmm" class="pill px-4 py-2 rounded-full text-sm transition">Datto RMM</a>
        <a href="#edr" class="pill px-4 py-2 rounded-full text-sm transition">Datto EDR</a>
        <a href="#k365" class="pill px-4 py-2 rounded-full text-sm transition">Kaseya 365</a>
        <a href="#comparatif" class="pill px-4 py-2 rounded-full text-sm transition">Comparatif</a>
      </div>
    </section>

    <!-- FIXED BACK LINK -->
    <a
      href="/"
      class="backbtn fixed right-6 top-5 z-50 inline-flex items-center px-4 py-2 rounded-lg shadow-lg backdrop-blur transition-all"
      style="background: rgba(18,18,18,0.85); border: 1px solid rgba(255,255,255,0.10); color: color-mix(in srgb, white 90%, transparent);"
    >
      ‚Üê Retour √† la page Services TI
    </a>

    <!-- BAND (BLANC) -->
    <section class="relative w-full overflow-hidden" style="background: var(--band);">

      <!-- LIGNE OR + FADE (comme index) -->
      <div class="h-[2px] w-full" style="background: var(--accent);"></div>
      <div class="h-14 w-full"
           style="background: linear-gradient(to bottom, color-mix(in srgb, var(--accent) 18%, transparent), transparent);">
      </div>

      <!-- Contenu -->
      <div class="relative mx-auto max-w-6xl px-4 pb-20 space-y-16">

        <!-- Intro -->
        <section class="grid md:grid-cols-2 gap-10 pt-10">
          <div>
            <h3 class="text-2xl font-semibold band-title">Une TI fiable, sans surprises</h3>
            <p class="mt-3 band-soft leading-relaxed">
              Le but : r√©duire les incidents, acc√©l√©rer le support et limiter l‚Äôimpact des cybermenaces
              avec une approche proactive.
            </p>

            <ul class="mt-4 list-disc ml-6 space-y-2 band-soft">
              <li>Surveillance et alertes 24/7</li>
              <li>Correctifs et entretien automatis√©s</li>
              <li>D√©tection avanc√©e (ransomware, comportements suspects)</li>
              <li>R√©ponse rapide en cas d‚Äôincident</li>
            </ul>
          </div>

          <div class="grid gap-4">
            {[
              ["üîç","Visibilit√© compl√®te","√âtat du parc, alertes, posture s√©curit√©."],
              ["‚öôÔ∏è","Automatisation","Patching, scripts, rem√©diations."],
              ["üõ°Ô∏è","Protection moderne","D√©tection comportementale & r√©ponse."],
            ].map(([icon, title, desc]) => (
              <div class="group relative overflow-hidden rounded-2xl p-6 card-surface">
                <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>
                <div class="relative flex items-start gap-4">
                  <div class="text-2xl">{icon}</div>
                  <div>
                    <p class="text-white font-semibold">{title}</p>
                    <p class="mt-1 muted-on-dark text-sm">{desc}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>

        <!-- RMM -->
        <section id="rmm" class="space-y-6">
          <div class="flex items-baseline justify-between gap-6 flex-wrap">
            <h3 class="text-2xl font-semibold band-title">Datto RMM</h3>
            <span class="text-sm band-muted">Supervision & maintenance proactive</span>
          </div>

          <div class="grid md:grid-cols-3 gap-6">
            {[
              ["Surveillance 24/7","Alertes en temps r√©el sur la sant√© des postes/serveurs."],
              ["Patching & maintenance","Correctifs et t√¢ches d‚Äôentretien automatis√©s, moins d‚Äôincidents."],
              ["Automatisation","Scripts, rem√©diations, inventaire et optimisation continue."],
            ].map(([t, d]) => (
              <div class="group relative overflow-hidden rounded-2xl p-6 card-surface">
                <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>
                <div class="relative">
                  <h4 class="text-lg font-semibold" style="color: var(--accent);">{t}</h4>
                  <p class="mt-2 soft-on-dark text-sm">{d}</p>
                </div>
              </div>
            ))}
          </div>
        </section>

        <!-- EDR -->
        <section id="edr" class="space-y-6">
          <div class="flex items-baseline justify-between gap-6 flex-wrap">
            <h3 class="text-2xl font-semibold band-title">Datto EDR</h3>
            <span class="text-sm band-muted">D√©tection & r√©ponse (menaces avanc√©es)</span>
          </div>

          <div class="grid md:grid-cols-3 gap-6">
            {[
              ["D√©tection comportementale","Bloque les attaques m√™me inconnues (ransomware, intrusions)."],
              ["Isolation & r√©ponse","Limite la propagation et acc√©l√®re la rem√©diation."],
              ["Tra√ßabilit√©","Meilleure visibilit√© pour comprendre et documenter un incident."],
            ].map(([t, d]) => (
              <div class="group relative overflow-hidden rounded-2xl p-6 card-surface">
                <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>
                <div class="relative">
                  <h4 class="text-lg font-semibold" style="color: var(--accent);">{t}</h4>
                  <p class="mt-2 soft-on-dark text-sm">{d}</p>
                </div>
              </div>
            ))}
          </div>
        </section>

        <!-- K365 -->
        <section id="k365" class="space-y-6">
          <div class="flex items-baseline justify-between gap-6 flex-wrap">
            <h3 class="text-2xl font-semibold band-title">Kaseya 365</h3>
            <span class="text-sm band-muted">Suite s√©curit√© centralis√©e</span>
          </div>

          <div class="grid md:grid-cols-3 gap-6">
            {[
              ["Centralisation","Une vue d‚Äôensemble s√©curit√© et contr√¥le coh√©rent."],
              ["R√©ponse automatis√©e","R√©duit le temps de r√©action et les angles morts."],
              ["Posture s√©curit√©","Rapports et indicateurs pour piloter vos priorit√©s."],
            ].map(([t, d]) => (
              <div class="group relative overflow-hidden rounded-2xl p-6 card-surface">
                <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>
                <div class="relative">
                  <h4 class="text-lg font-semibold" style="color: var(--accent);">{t}</h4>
                  <p class="mt-2 soft-on-dark text-sm">{d}</p>
                </div>
              </div>
            ))}
          </div>
        </section>

        <!-- Forfaits -->
        <section id="forfaits" class="space-y-8">
          <div class="text-center">
            <h3 class="text-xs uppercase tracking-[0.25em] band-muted">Forfaits mensuels</h3>
            <p class="mt-2 band-soft">Choisis un niveau de couverture ‚Äî simple, clair, sans surprise.</p>
          </div>

          <div class="grid md:grid-cols-3 gap-8">
            {[
              ["RMM + EDR", "$6", "Supervision + protection avanc√©e", ["Monitoring 24/7","Patching automatis√©","D√©tection & r√©ponse EDR","Support et rem√©diation"]],
              ["Kaseya 365", "$8", "Suite centralis√©e", ["Gestion s√©curit√© centralis√©e","Visibilit√© posture s√©curit√©","R√©ponses automatis√©es","Rapports & recommandations"]],
              ["Tous les services", "$13", "Maximum protection + maximum automatisation", ["Datto RMM + Datto EDR","Kaseya 365","Support prioritaire","Revue s√©curit√© & roadmap"]],
            ].map(([title, price, subtitle, bullets], idx) => (
              <div class={`group relative overflow-hidden rounded-2xl p-8 ${idx === 2 ? "" : "card-surface"}`}
                   style={idx === 2 ? `background: rgb(18,18,18); border: 1px solid rgba(0,0,0,0.14); box-shadow: 0 14px 40px rgba(0,0,0,0.18);` : ""}>
                <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100 hover-tint"></div>

                <div class="relative">
                  <h4 class="text-xl font-semibold" style="color: white;">{title}</h4>
                  <p class="mt-2 muted-on-dark">{subtitle}</p>

                  <p class="mt-5">
                    <span class="font-extrabold text-5xl" style="color:white;">{price}</span>
                    <span class="muted-on-dark"> / utilisateur / mois</span>
                  </p>

                  <ul class="mt-6 list-disc ml-6 space-y-2 soft-on-dark text-sm">
                    {bullets.map((b) => <li>{b}</li>)}
                  </ul>

                  <a href="#soumission"
                     class="mt-7 inline-flex items-center justify-center w-full px-5 py-3 rounded-xl font-semibold transition hover:brightness-110"
                     style="background: var(--accent); color: #111;">
                    Demander une soumission ‚Üí
                  </a>
                </div>
              </div>
            ))}
          </div>

          <p class="band-muted text-xs">
            * Prix par utilisateur/mois. Certaines conditions peuvent s‚Äôappliquer selon l‚Äôenvironnement.
          </p>
        </section>

        <!-- Comparatif -->
        <section id="comparatif" class="space-y-6">
          <h3 class="text-2xl font-semibold band-title">Tableau comparatif</h3>

          <div class="rounded-2xl overflow-hidden card-surface">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead style="background: rgba(255,255,255,0.06);">
                  <tr class="text-white/80">
                    <th class="text-left px-5 py-4 font-semibold">Fonction</th>
                    <th class="text-left px-5 py-4 font-semibold">RMM + EDR (6$)</th>
                    <th class="text-left px-5 py-4 font-semibold">Kaseya 365 (8$)</th>
                    <th class="text-left px-5 py-4 font-semibold">Combin√© (13$)</th>
                  </tr>
                </thead>
                <tbody class="soft-on-dark">
                  {[
                    ["Surveillance 24/7 & alertes","‚úÖ","‚Äî","‚úÖ"],
                    ["Correctifs / patching automatis√©","‚úÖ","‚Äî","‚úÖ"],
                    ["Automatisation (scripts / rem√©diation)","‚úÖ","‚Äî","‚úÖ"],
                    ["Inventaire / visibilit√© parc","‚úÖ","‚Äî","‚úÖ"],
                    ["D√©tection comportementale (EDR)","‚úÖ","‚úÖ","‚úÖ"],
                    ["Isolation / r√©ponse incident","‚úÖ","‚úÖ","‚úÖ"],
                    ["Suite centralis√©e / gouvernance","‚Äî","‚úÖ","‚úÖ"],
                    ["Support prioritaire & roadmap","‚Äî","‚Äî","‚úÖ"],
                  ].map(([f,a,b,c]) => (
                    <tr style="border-top: 1px solid rgba(255,255,255,0.08);">
                      <td class="px-5 py-4">{f}</td>
                      <td class="px-5 py-4">{a}</td>
                      <td class="px-5 py-4">{b}</td>
                      <td class="px-5 py-4">{c}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Soumission -->
        <section id="soumission">
          <div class="rounded-2xl p-10 card-surface relative overflow-hidden">
            <div class="pointer-events-none absolute inset-0 opacity-40"
                 style="background: radial-gradient(circle at 20% 20%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 60%);">
            </div>

            <div class="relative">
              <h4 class="text-3xl font-semibold mb-3" style="color:white;">Demande de soumission</h4>
              <p class="soft-on-dark mb-6">
                Indique le nombre d‚Äôutilisateurs et les services souhait√©s. On te revient rapidement.
              </p>

              <button id="openQuoteBtn"
                      class="inline-flex items-center justify-center px-7 py-3 rounded-xl font-semibold transition hover:brightness-110"
                      style="background: var(--accent); color:#111;">
                Ouvrir le formulaire
              </button>

              <div id="quoteFormContainer" class="overflow-hidden max-h-0 opacity-0 transition-all duration-500 mt-6">
                <form id="quoteForm" class="space-y-4 p-6 rounded-xl"
                      style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10);">
                  <h5 class="text-xl font-semibold mb-2" style="color:white;">Informations</h5>

                  <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Nom de l‚Äôorganisation</label>
                  <input type="text" name="quote_org" required class="w-full rounded-lg px-3 py-2"
                         style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />

                  <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Courriel</label>
                  <input type="email" name="quote_email" required class="w-full rounded-lg px-3 py-2"
                         style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />

                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">Nombre d‚Äôutilisateurs</label>
                      <input type="number" name="quote_users" min="1" required class="w-full rounded-lg px-3 py-2"
                             style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />
                    </div>
                    <div>
                      <label class="block text-sm font-medium" style="color: rgba(255,255,255,0.92);">T√©l√©phone (optionnel)</label>
                      <input type="text" name="quote_phone" class="w-full rounded-lg px-3 py-2"
                             style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;" />
                    </div>
                  </div>

                  <h6 class="text-sm font-semibold mt-2" style="color: rgba(255,255,255,0.92);">Services souhait√©s</h6>
                  <div class="grid md:grid-cols-2 gap-3 text-sm soft-on-dark">
                    <label class="flex items-center gap-2">
                      <input type="checkbox" name="svc_rmm_edr" value="yes" style={`accent-color: ${accent};`} />
                      RMM + EDR (6$)
                    </label>
                    <label class="flex items-center gap-2">
                      <input type="checkbox" name="svc_k365" value="yes" style={`accent-color: ${accent};`} />
                      Kaseya 365 (8$)
                    </label>
                    <label class="flex items-center gap-2 md:col-span-2">
                      <input type="checkbox" name="svc_bundle" value="yes" style={`accent-color: ${accent};`} />
                      Tous les services (13$)
                    </label>
                  </div>

                  <label class="block text-sm font-medium mt-2" style="color: rgba(255,255,255,0.92);">Notes (optionnel)</label>
                  <textarea name="quote_notes" rows="4" class="w-full rounded-lg px-3 py-2"
                            style="background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.10); color: white;"
                            placeholder="Ex : t√©l√©travail, serveurs, sites multiples, exigences conformit√©, etc."></textarea>

                  <button type="submit" class="mt-4 w-full px-4 py-2 rounded-lg font-semibold transition hover:brightness-110"
                          style="background: var(--accent); color:#111;">
                    Envoyer la demande
                  </button>

                  <button type="button" id="closeQuoteBtn" class="w-full px-4 py-2 rounded-lg font-medium transition hover:brightness-110"
                          style="background: rgba(255,255,255,0.06); color: white; border: 1px solid rgba(255,255,255,0.10);">
                    Fermer
                  </button>

                  <p id="quoteStatus" class="text-sm mt-2 soft-on-dark"></p>
                </form>
              </div>
            </div>
          </div>
        </section>

        <!-- Loi 25 -->
        <section class="rounded-2xl p-8 card-surface">
          <div class="flex items-start gap-4">
            <div class="text-3xl">üßæ</div>
            <div>
              <h4 class="text-xl font-semibold mb-2" style="color: white;">Conformit√© & bonnes pratiques</h4>
              <p class="soft-on-dark leading-relaxed">
                Ces services am√©liorent la visibilit√©, la d√©tection et la r√©ponse aux incidents ‚Äî une base solide
                pour r√©duire les risques, soutenir les exigences (ex : Loi 25) et documenter la gestion de la s√©curit√©.
              </p>
            </div>
          </div>
        </section>

      </div>
    </section>

    <script>
      const btn = document.getElementById("openQuoteBtn");
      const closeBtn = document.getElementById("closeQuoteBtn");
      const panel = document.getElementById("quoteFormContainer");
      const form = document.getElementById("quoteForm");
      const status = document.getElementById("quoteStatus");

      if (btn && closeBtn && panel && form && status) {
        btn.addEventListener("click", () => {
          panel.style.maxHeight = panel.scrollHeight + "px";
          panel.style.opacity = "1";
          panel.scrollIntoView({ behavior: "smooth", block: "start" });
        });

        closeBtn.addEventListener("click", () => {
          panel.style.maxHeight = "0";
          panel.style.opacity = "0";
        });

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const fd = new FormData(form);
          const data = {};
          for (const [k, v] of fd.entries()) data[k] = v;

          status.textContent = "Envoi‚Ä¶";

          try {
            const res = await fetch("/api/submit", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });

            if (res.ok) {
              status.textContent = "Demande envoy√©e!";
              form.reset();
            } else {
              status.textContent = "Erreur d‚Äôenvoi.";
            }
          } catch (err) {
            status.textContent = "Erreur r√©seau.";
          }
        });
      }
    </script>

  </div>
</SiteLayout>
